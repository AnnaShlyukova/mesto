!function(){"use strict";class e{constructor(e,t,s,n,r,i){this._name=e.name,this._link=e.link,this._likes=e.likes,this._ownerId=e.owner._id,this._id=e._id,this._userId=r,this._cardSelector=i,this._handleCardClick=s,this._openImageView=n,this._likeCard=t,this._element=this._getTemplate(),this._buttonLikeElement=this._element.querySelector(".gallery__like"),this._likeCount=this._element.querySelector(".gallery__like-count"),this._buttonDeletElement=this._element.querySelector(".gallery__button-delete"),this._galleryTitle=this._element.querySelector(".gallery__title"),this._galleryImage=this._element.querySelector(".gallery__image")}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".gallery__item").cloneNode(!0)}_deleteIcon(){this._ownerId===this._userId&&this._buttonDeletElement.classList.add("gallery__button-delete_visible")}generateCard(){this._galleryImage.src=this._link,this._galleryTitle.textContent=this._name,this._galleryImage.alt=this._name,this._likeCount.textContent=this._likes.length}handleDeleteCard(){this._element.remove(),this._element=null}checkLike(){return this._buttonLikeElement.classList.contains("gallery__like_active")}idCard(){return this._element.dataset.id=this._id,this._cardId=this._element.dataset.id,console.log(this._id),this._cardId}updateLikes(e){this._data=e,this._likeCount.textContent=this._data.likes.length,this._buttonLikeElement.classList.toggle("gallery__like_active",!this.checkLike())}_isLiked(){this._likes.forEach((e=>{e._id===this._userId&&this._buttonLikeElement.classList.add("gallery__like_active")}))}_setEventListener(){this._buttonLikeElement.addEventListener("click",(()=>{this._likeCard(this)})),this._buttonDeletElement.addEventListener("click",(()=>{this._handleCardClick(this)})),this._galleryImage.addEventListener("click",(()=>{this._openImageView(this._name,this._link)}))}createCard(){return this.idCard(),this._isLiked(),this._setEventListener(),this._deleteIcon(),this.generateCard(),this._element}}class t{constructor(e,t){this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}_showInputError(e,t){const s=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),s.classList.add(this._errorClass),s.textContent=t}_hideInputError(e){const t=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput(this._inputList)?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.setAttribute("disabled",!0)):(this._buttonElement.removeAttribute("disabled"),this._buttonElement.classList.remove(this._inactiveButtonClass))}clearError(){this._inputList.forEach((e=>{this._hideInputError(e)})),this._toggleButtonState()}_setEventListeners(){this._toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._setEventListeners()}}class s{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.addEventListener("mousedown",(e=>{(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup__button-close"))&&this.close()}))}}class n extends s{constructor(e){let{popupSelector:t,handleFormSubmit:s}=e;super(t),this._form=this._popup.querySelector(".popup__form"),this._inputList=this._form.querySelectorAll(".popup__input"),this._handleFormSubmit=s}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this.close()}))}close(){super.close(),this._form.reset()}}const r=document.querySelector(".popup-avatar").querySelector(".popup__button"),i=document.querySelector(".profile__photo"),o=document.querySelector(".popup_content_gallery").querySelector(".popup__button"),a=document.querySelector(".popup_content_profile").querySelector(".popup__button"),l=document.querySelector(".profile__button-edit_open-popup"),h=document.querySelector(".profile__button-add_open-popup"),c=document.forms.profileForm,_=c.elements.nameInput,u=c.elements.bioInput,d=document.forms.addForm,p=document.forms.avatarEdit,m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};let E;const v=new class{constructor(e){this._url=e.url,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}getCards(){return fetch("".concat(this._url,"cards"),{method:"GET",headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch("".concat(this._url,"users/me"),{method:"GET",headers:this._headers}).then(this._checkResponse)}setUserInfo(e){let{name:t,about:s}=e;return fetch("".concat(this._url,"users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:s})}).then(this._checkResponse)}addCard(e){let{name:t,link:s}=e;return fetch("".concat(this._url,"cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then(this._checkResponse)}deleteCard(e){return fetch("".concat(this._url,"cards/").concat(e),{method:"DELETE",headers:this._headers,body:JSON.stringify({_id:"".concat(e)})}).then(this._checkResponse)}setlike(e){return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"PUT",headers:this._headers,body:JSON.stringify({_id:"".concat(e)})}).then(this._checkResponse)}removeLike(e){return fetch("".concat(this._url,"cards/likes/").concat(e),{method:"DELETE",headers:this._headers,body:JSON.stringify({_id:"".concat(e)})}).then(this._checkResponse)}addUserAvatar(e){let{avatar:t}=e;return fetch("".concat(this._url,"users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})}).then(this._checkResponse)}changeLikeCard(e,t){return fetch("".concat(this._url,"cards/likes/").concat(e),{method:t?"DELETE":"PUT",headers:this._headers}).then(this._checkResponse)}}({url:"https://nomoreparties.co/v1/cohort-46/",headers:{authorization:"fca940e1-04e1-4b78-84e8-f1d5400ed073","Content-Type":"application/json"}}),f=new t(m,c),g=new t(m,d);new t(m,p).enableValidation(),f.enableValidation(),g.enableValidation();const y=t=>{const s=new e(t,(e=>{v.changeLikeCard(e.idCard(),e.checkLike()).then((t=>{e.updateLikes(t)})).catch((e=>console.log(e)))}),(()=>{S.handleConfirm((()=>{v.deleteCard(t._id).then((()=>{s.handleDeleteCard(),S.close()})).catch((e=>{console.log(e)}))})),S.open()}),((e,t)=>{C.open(e,t)}),E,"#gallery-template");return s.createCard()},k=new class{constructor(e,t){this._renderer=e,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}renderItems(e){e.reverse().forEach((e=>{this.addItem(this._renderer(e))}))}}(y,".gallery__list"),b=new class{constructor(e,t,s){this._nameElement=document.querySelector(e),this._bioElement=document.querySelector(t),this.avatar=document.querySelector(s)}getUserInfo(){return{name:this._nameElement.textContent,bio:this._bioElement.textContent}}setUserInfo(e){this._nameElement.textContent=e.name,this._bioElement.textContent=e.about,this.setAvatarInfo(e.avatar)}setAvatarInfo(e){this.avatar.src=e}}(".profile__name",".profile__bio",".profile__avatar"),C=new class extends s{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._title=this._popup.querySelector(".popup__image-caption")}open(e,t){this._image.src=t,this._title.textContent=e,this._image.alt=e,super.open()}}(".popup_content_image-view"),S=new class extends s{constructor(e){super(e),this._form=this._popup.querySelector(".popup__form")}handleConfirm(e){this._handleSubmit=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this._handleSubmit()}))}}(".popup_confirm"),L=new n({popupSelector:".popup_content_profile",handleFormSubmit:e=>{a.textContent="Сохранение...",v.setUserInfo({name:e.nameInput,about:e.bioInput}).then((e=>{b.setUserInfo(e),L.close()})).catch((e=>{console.log(e)})).finally((()=>{a.textContent="Сохранить"}))}}),I=new n({popupSelector:".popup_content_gallery",handleFormSubmit:e=>{o.textContent="Сохранение...",v.addCard({name:e.name,link:e.link}).then((e=>{k.addItem(y(e)),I.close()})).catch((e=>{console.log(e)})).finally((()=>{o.textContent="Сохранить"}))}}),q=new n({popupSelector:".popup-avatar",handleFormSubmit:e=>{r.textContent="Сохранение...",v.addUserAvatar({avatar:e.avatar}).then((e=>{console.log(e),b.setAvatarInfo(e.avatar),q.close()})).catch((e=>{console.log(e)})).finally((()=>{r.textContent="Сохранить"}))}});L.setEventListeners(),C.setEventListeners(),I.setEventListeners(),S.setEventListeners(),q.setEventListeners(),Promise.all([v.getUserInfo(),v.getCards()]).then((e=>{let[t,s]=e;E=t._id,b.setUserInfo(t),k.renderItems(s)})).catch((e=>{console.log(e)})),l.addEventListener("click",(()=>{const e=b.getUserInfo();_.value=e.name,u.value=e.bio,f.clearError(),L.open()})),h.addEventListener("click",(()=>{g.clearError(),I.open()})),i.addEventListener("click",(()=>{q.open()}))}();